<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Job Market Analysis: Abhisek Mohapatra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 250px;
            margin: 0 auto;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Connection Status Banner -->
    <div id="connection-status" class="bg-amber-100 border-b border-amber-200 text-amber-800 px-4 py-2 text-sm text-center font-medium transition-colors duration-300">
        <span class="animate-pulse">üîÑ Connecting to live data source...</span>
    </div>

    <!-- Sandbox Warning Banner -->
    <div id="sandbox-warning" class="hidden bg-slate-800 text-white px-4 py-2 text-xs text-center font-medium">
        ‚ö†Ô∏è Note: Viewing in a preview window. To save tracked jobs across sessions, download this HTML file.
    </div>

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-xl font-bold text-slate-800 tracking-tight">Executive Market Analysis</h1>
                <p class="text-xs text-slate-500">Candidate: Abhisek Mohapatra | Target: Singapore FinTech/AI Product</p>
            </div>
            <div class="flex space-x-6 text-sm font-medium">
                <div class="flex items-center space-x-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-emerald-500"></span>
                    <span class="text-slate-700">High Fit: <span id="hero-high-count" class="font-bold">0</span></span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-slate-800"></span>
                    <span class="text-slate-700">Total Scanned: <span id="hero-total-count" class="font-bold">0</span></span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12 w-full">
        <!-- Main Content Area (Hidden until data loads) -->
        <div id="dashboard-content" class="opacity-0 transition-opacity duration-500 space-y-12">
            
            <!-- Section 1: Market Analytics Dashboard -->
            <section id="analytics" class="space-y-6">
                <div class="space-y-2">
                    <h2 class="text-2xl font-bold text-slate-900">Market Landscape Overview</h2>
                    <p class="text-slate-600 max-w-3xl leading-relaxed">
                        This dynamic dashboard synthesizes live opportunities fetched from your repository. 
                        <strong>Click on any chart segment (bars or pie slices) to instantly filter the job list below.</strong>
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col hover:shadow-md transition-shadow">
                        <h3 class="text-sm font-semibold text-slate-800 mb-2 border-b border-slate-100 pb-2">Feasibility Score Distribution</h3>
                        <div class="flex-grow flex items-center justify-center w-full">
                            <div class="chart-container cursor-pointer"><canvas id="scoreChart"></canvas></div>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col hover:shadow-md transition-shadow">
                        <h3 class="text-sm font-semibold text-slate-800 mb-2 border-b border-slate-100 pb-2">Recruiter Verdict Categories</h3>
                        <div class="flex-grow flex items-center justify-center w-full">
                            <div class="chart-container cursor-pointer"><canvas id="verdictChart"></canvas></div>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col hover:shadow-md transition-shadow">
                        <h3 class="text-sm font-semibold text-slate-800 mb-2 border-b border-slate-100 pb-2">Fortune 500 vs. Market</h3>
                        <div class="flex-grow flex items-center justify-center w-full">
                            <div class="chart-container cursor-pointer"><canvas id="fortuneChart"></canvas></div>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col hover:shadow-md transition-shadow">
                        <h3 class="text-sm font-semibold text-slate-800 mb-2 border-b border-slate-100 pb-2">Job Posting Recency</h3>
                        <div class="flex-grow flex items-center justify-center w-full">
                            <div class="chart-container cursor-pointer"><canvas id="postedChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Interactive Job Explorer -->
            <section id="explorer" class="scroll-mt-24">
                <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-4 mb-6">
                    <div class="space-y-2">
                        <h2 class="text-2xl font-bold text-slate-900">Opportunity Explorer</h2>
                        <p class="text-slate-600 max-w-2xl text-sm">
                            Check the box on the right to save a job to your local tracking list.
                        </p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 items-center bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                        <div class="relative">
                            <select id="filter-verdict" class="appearance-none bg-slate-50 border border-slate-300 text-slate-700 py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm font-medium">
                                <option value="all">All Verdicts</option>
                                <option value="yes">üü¢ High Fit (Yes)</option>
                                <option value="maybe">üü† Moderate Fit (Maybe)</option>
                                <option value="no">üî¥ Low Fit (No)</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500"><svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg></div>
                        </div>

                        <div class="relative">
                            <select id="filter-f500" class="appearance-none bg-slate-50 border border-slate-300 text-slate-700 py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm font-medium">
                                <option value="all">All Companies</option>
                                <option value="yes">Fortune 500 Only</option>
                                <option value="no">Non-Fortune 500</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500"><svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg></div>
                        </div>

                        <button id="reset-filters" class="bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg text-sm transition-colors border border-slate-300">
                            Reset All Filters
                        </button>
                        
                        <div id="active-chart-filters" class="text-xs text-indigo-700 font-semibold ml-2 px-3 py-1.5 bg-indigo-50 rounded-lg border border-indigo-200 hidden items-center gap-2">
                            <span>Active Chart Filters: <span id="filter-list-text" class="font-normal"></span></span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider w-10">#</th>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Score</th>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Role</th>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Company</th>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Posted</th>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Verdict</th>
                                    <th scope="col" class="px-4 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider">Link</th>
                                    <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-slate-500 uppercase tracking-wider bg-emerald-50 text-emerald-800">Applied</th>
                                </tr>
                            </thead>
                            <tbody id="job-table-body" class="bg-white divide-y divide-slate-100">
                                <!-- Rows injected by JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="bg-slate-50 px-6 py-4 border-t border-slate-200 flex items-center justify-between">
                        <span class="text-sm text-slate-600">Showing <span id="showing-count" class="font-bold text-slate-900 bg-white px-2 py-1 rounded border border-slate-200">0</span> roles matching criteria</span>
                    </div>
                </div>
            </section>

            <!-- Section 3: Tracked Applications -->
            <section id="applied-section" class="scroll-mt-24 hidden">
                <div class="space-y-2 mb-6 border-t-2 border-dashed border-slate-200 pt-10">
                    <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-3">
                        <svg class="w-7 h-7 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Your Tracked Applications
                    </h2>
                    <p class="text-slate-600 max-w-2xl text-sm">
                        Roles you have marked are saved securely in your browser's local storage. This list will persist even if you refresh or close the page.
                    </p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border-2 border-emerald-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-emerald-100">
                            <thead class="bg-emerald-50/50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-emerald-800 uppercase tracking-wider">Company</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-emerald-800 uppercase tracking-wider">Role</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-emerald-800 uppercase tracking-wider w-24">Score</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-emerald-800 uppercase tracking-wider w-32">Status</th>
                                </tr>
                            </thead>
                            <tbody id="applied-table-body" class="bg-white divide-y divide-emerald-50">
                                <!-- Rows injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="bg-slate-900 text-slate-400 py-8 mt-12 border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm flex flex-col items-center justify-center gap-2">
            <p>&copy; 2026 Executive Recruiter AI Agent. Generated for Abhisek Mohapatra.</p>
            <p class="text-slate-500">Data fetched dynamically from configured repository.</p>
        </div>
    </footer>

    <script>
        // =====================================================================
        // CONFIGURATION
        // =====================================================================
        const GITHUB_JSON_URL = 'https://raw.githubusercontent.com/mohptr/JobBoard/refs/heads/main/jobs.json';
        
        // =====================================================================
        // STATE & INITIALIZATION
        // =====================================================================
        let jobData = [];
        let chartInstances = {}; 
        let chartFilters = { score: null, verdict: null, f500: null, posted: null };
        let appliedJobs = JSON.parse(localStorage.getItem('abhisek_applied_jobs_v4')) || [];

        // Display sandbox warning if needed
        if (window.self !== window.top || window.location.protocol === 'data:') {
            document.getElementById('sandbox-warning').classList.remove('hidden');
        }

        // =====================================================================
        // DATA FETCHING LOGIC
        // =====================================================================
        async function loadJobData() {
            const statusBanner = document.getElementById('connection-status');
            
            try {
                if (!GITHUB_JSON_URL || GITHUB_JSON_URL.includes('YOUR_RAW_GITHUB_JSON_URL_HERE')) {
                    throw new Error("URL not configured");
                }
                
                // Added a cache-busting query parameter so it always fetches fresh data
                const response = await fetch(`${GITHUB_JSON_URL}?t=${new Date().getTime()}`, { cache: "no-store" });
                if (!response.ok) throw new Error('Network response was not ok');
                
                jobData = await response.json();
                
                // Success UI Update
                statusBanner.className = "bg-emerald-100 border-b border-emerald-200 text-emerald-800 px-4 py-2 text-sm text-center font-medium transition-colors duration-300";
                statusBanner.innerHTML = "‚úÖ Successfully connected to live Git repository. Data is up to date.";
                
                setTimeout(() => { statusBanner.style.display = 'none'; }, 3000);

            } catch (error) {
                console.warn("Could not fetch from Git repo. Falling back to offline sample data.", error);
                
                statusBanner.className = "bg-rose-100 border-b border-rose-200 text-rose-800 px-4 py-2 text-sm text-center font-medium transition-colors duration-300";
                statusBanner.innerHTML = "‚ö†Ô∏è Cannot reach Git Repo. Viewing Offline Sample Data.";
                
                jobData = getFallbackData();
            }

            // Reveal Dashboard and Initialize
            document.getElementById('dashboard-content').classList.remove('opacity-0');
            
            document.getElementById('hero-total-count').textContent = jobData.length;
            document.getElementById('hero-high-count').textContent = jobData.filter(j => j.score >= 8.0).length;

            initCharts();
            renderTable();
            renderAppliedJobs();
        }

        // =====================================================================
        // TABLE & FILTER RENDERING
        // =====================================================================
        function getJobId(job) { return `${job.company}:::${job.title}`; }

        window.toggleAppliedStatus = function(jobId) {
            if (appliedJobs.includes(jobId)) {
                appliedJobs = appliedJobs.filter(id => id !== jobId);
            } else {
                appliedJobs.push(jobId);
            }
            localStorage.setItem('abhisek_applied_jobs_v4', JSON.stringify(appliedJobs));
            renderAppliedJobs();
            renderTable(); 
        };

        function getAgeBucket(postedStr) {
            if(!postedStr) return '> 7 Days';
            const p = postedStr.toLowerCase();
            if (p.includes('hour') || p.includes('just') || p.includes('1 day') || p.includes('2 day') || p.includes('3 day')) return '‚â§ 3 Days';
            if (p.includes('4 day') || p.includes('5 day') || p.includes('6 day') || p.includes('1 week') || p.includes('7 day')) return '4-7 Days';
            return '> 7 Days'; 
        }

        const tableBody = document.getElementById('job-table-body');
        const countSpan = document.getElementById('showing-count');
        const activeFiltersDisplay = document.getElementById('active-chart-filters');
        const filterListText = document.getElementById('filter-list-text');
        const appliedSection = document.getElementById('applied-section');
        const appliedTableBody = document.getElementById('applied-table-body');

        function updateFilterDisplay() {
            const active = Object.values(chartFilters).filter(v => v !== null);
            if (active.length > 0) {
                filterListText.textContent = active.join(' + ');
                activeFiltersDisplay.style.display = 'flex';
            } else {
                activeFiltersDisplay.style.display = 'none';
            }
        }

        function renderTable() {
            tableBody.innerHTML = '';
            
            const verdictVal = document.getElementById('filter-verdict').value;
            const f500Val = document.getElementById('filter-f500').value;

            const filtered = jobData.filter(job => {
                let vMatch = true;
                if (verdictVal === 'yes') vMatch = job.verdict.includes('YES');
                else if (verdictVal === 'maybe') vMatch = job.verdict.includes('MAYBE');
                else if (verdictVal === 'no') vMatch = job.verdict.includes('NO');

                let fMatch = true;
                if (f500Val === 'yes') fMatch = job.f500 === true;
                else if (f500Val === 'no') fMatch = job.f500 === false;

                let chartSMatch = true;
                if (chartFilters.score) {
                    if (chartFilters.score === '9-10') chartSMatch = job.score >= 9;
                    else if (chartFilters.score === '8-9') chartSMatch = job.score >= 8 && job.score < 9;
                    else if (chartFilters.score === '7-8') chartSMatch = job.score >= 7 && job.score < 8;
                    else if (chartFilters.score === '6-7') chartSMatch = job.score >= 6 && job.score < 7;
                    else chartSMatch = job.score < 6;
                }

                let chartVMatch = true;
                if (chartFilters.verdict) {
                    if (chartFilters.verdict === 'High Fit (Yes)') chartVMatch = job.verdict.includes('YES');
                    else if (chartFilters.verdict === 'Moderate (Maybe)') chartVMatch = job.verdict.includes('MAYBE');
                    else chartVMatch = job.verdict.includes('NO');
                }

                let chartFMatch = true;
                if (chartFilters.f500) {
                    if (chartFilters.f500 === 'Fortune 500') chartFMatch = job.f500 === true;
                    else chartFMatch = job.f500 === false;
                }

                let chartPMatch = true;
                if (chartFilters.posted) {
                    chartPMatch = getAgeBucket(job.posted) === chartFilters.posted;
                }

                return vMatch && fMatch && chartSMatch && chartVMatch && chartFMatch && chartPMatch;
            });

            countSpan.textContent = filtered.length;
            updateFilterDisplay();

            if (filtered.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="8" class="px-6 py-8 text-center text-slate-500 font-medium">No jobs match these combined filters. Try resetting.</td></tr>`;
                return;
            }

            let serialCounter = 1;

            filtered.forEach(job => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-indigo-50/50 transition-colors group";
                
                const jobId = getJobId(job);
                const isApplied = appliedJobs.includes(jobId);

                let scoreClass = 'text-slate-800 bg-slate-100 border-slate-200';
                if(job.score >= 8) scoreClass = 'text-emerald-700 bg-emerald-50 border-emerald-200';
                else if(job.score >= 6) scoreClass = 'text-amber-700 bg-amber-50 border-amber-200';
                else scoreClass = 'text-rose-700 bg-rose-50 border-rose-200';

                let verdictShort = 'Unknown';
                let verdictColor = 'text-slate-500';
                if(job.verdict.includes('YES')) { verdictShort = 'High Fit'; verdictColor = 'text-emerald-600 font-semibold'; }
                else if(job.verdict.includes('MAYBE')) { verdictShort = 'Moderate / Tweaks'; verdictColor = 'text-amber-600 font-medium'; }
                else if(job.verdict.includes('NO')) { verdictShort = 'Low Fit'; verdictColor = 'text-rose-600 font-medium'; }

                const rowOpacity = isApplied ? 'opacity-50' : 'opacity-100';
                const strikeTitle = isApplied ? 'line-through text-slate-400' : 'text-slate-900';

                tr.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap text-xs font-mono text-slate-400 ${rowOpacity}">${serialCounter++}</td>
                    <td class="px-4 py-4 whitespace-nowrap ${rowOpacity}">
                        <span class="inline-flex items-center justify-center px-2.5 py-1 rounded-md text-xs font-bold border ${scoreClass}">${job.score.toFixed(1)}</span>
                    </td>
                    <td class="px-4 py-4 ${rowOpacity}"><div class="text-sm font-semibold ${strikeTitle}">${job.title}</div></td>
                    <td class="px-4 py-4 whitespace-nowrap ${rowOpacity}">
                        <div class="flex items-center">
                            <span class="text-sm ${isApplied ? 'text-slate-400' : 'text-slate-700 font-medium'}">${job.company}</span>
                            ${job.f500 ? '<span class="ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-blue-100 text-blue-700 uppercase tracking-wider">F500</span>' : ''}
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-slate-500 ${rowOpacity}">${job.posted}</td>
                    <td class="px-4 py-4 text-sm ${verdictColor} ${rowOpacity}">${verdictShort}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium ${rowOpacity}">
                        <a href="${job.link}" target="_blank" class="text-indigo-600 hover:text-indigo-900 group-hover:underline inline-flex items-center gap-1" onclick="event.stopPropagation();">
                            Apply <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </a>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-center bg-slate-50 border-l border-slate-100">
                        <input type="checkbox" 
                               class="w-5 h-5 text-emerald-600 bg-white border-slate-300 rounded focus:ring-emerald-500 focus:ring-2 cursor-pointer transition-colors" 
                               ${isApplied ? 'checked' : ''} 
                               onclick="event.stopPropagation(); toggleAppliedStatus('${jobId.replace(/'/g, "\\'")}')">
                    </td>
                `;
                
                tr.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'A' && e.target.tagName !== 'INPUT') {
                        document.querySelectorAll('tr').forEach(r => r.classList.remove('bg-indigo-50'));
                        tr.classList.add('bg-indigo-50');
                    }
                });
                tableBody.appendChild(tr);
            });
        }

        function renderAppliedJobs() {
            if (appliedJobs.length === 0) {
                appliedSection.classList.add('hidden');
                return;
            }
            appliedSection.classList.remove('hidden');
            appliedTableBody.innerHTML = '';
            const tracked = jobData.filter(job => appliedJobs.includes(getJobId(job)));

            tracked.forEach(job => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-emerald-50 transition-colors";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-bold text-slate-800">${job.company}</div></td>
                    <td class="px-6 py-4"><div class="text-sm font-medium text-slate-700">${job.title}</div></td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <span class="inline-flex items-center justify-center px-2 py-1 rounded text-xs font-bold bg-slate-100 text-slate-800">${job.score.toFixed(1)}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="toggleAppliedStatus('${getJobId(job).replace(/'/g, "\\'")}')" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-800 hover:bg-rose-100 hover:text-rose-800 group transition-colors focus:outline-none">
                            <span class="group-hover:hidden flex items-center gap-1"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>Saved</span>
                            <span class="hidden group-hover:flex items-center gap-1"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg>Remove</span>
                        </button>
                    </td>
                `;
                appliedTableBody.appendChild(tr);
            });
        }

        document.getElementById('filter-verdict').addEventListener('change', renderTable);
        document.getElementById('filter-f500').addEventListener('change', renderTable);
        document.getElementById('reset-filters').addEventListener('click', () => {
            document.getElementById('filter-verdict').value = 'all';
            document.getElementById('filter-f500').value = 'all';
            chartFilters = { score: null, verdict: null, f500: null, posted: null };
            renderTable();
        });

        // =====================================================================
        // CHART INITIALIZATION
        // =====================================================================
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#64748b';

        const interactiveOptions = {
            onHover: (event, chartElement) => {
                event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
            }
        };

        function initCharts() {
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};

            // 1. Score (Bar)
            const scoreBuckets = { '9-10': 0, '8-9': 0, '7-8': 0, '6-7': 0, '<6': 0 };
            jobData.forEach(j => {
                if (j.score >= 9) scoreBuckets['9-10']++;
                else if (j.score >= 8) scoreBuckets['8-9']++;
                else if (j.score >= 7) scoreBuckets['7-8']++;
                else if (j.score >= 6) scoreBuckets['6-7']++;
                else scoreBuckets['<6']++;
            });

            chartInstances.score = new Chart(document.getElementById('scoreChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(scoreBuckets),
                    datasets: [{
                        label: 'Jobs', data: Object.values(scoreBuckets),
                        backgroundColor: ['#10b981', '#34d399', '#f59e0b', '#fbbf24', '#e11d48'], borderRadius: 4
                    }]
                },
                options: {
                    maintainAspectRatio: false, responsive: true, plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { color: '#f1f5f9' } }, x: { grid: { display: false } } },
                    ...interactiveOptions,
                    onClick: (e, activeElements, chart) => {
                        if (activeElements.length > 0) {
                            const label = chart.data.labels[activeElements[0].index];
                            chartFilters.score = (chartFilters.score === label) ? null : label;
                            renderTable(); document.getElementById('explorer').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }
            });

            // 2. Verdict (Doughnut)
            let vCounts = { Yes: 0, Maybe: 0, No: 0 };
            jobData.forEach(j => {
                if (j.verdict.includes('YES')) vCounts.Yes++;
                else if (j.verdict.includes('MAYBE')) vCounts.Maybe++;
                else vCounts.No++;
            });

            chartInstances.verdict = new Chart(document.getElementById('verdictChart'), {
                type: 'doughnut',
                data: {
                    labels: ['High Fit (Yes)', 'Moderate (Maybe)', 'Low Fit (No)'],
                    datasets: [{
                        data: [vCounts.Yes, vCounts.Maybe, vCounts.No],
                        backgroundColor: ['#10b981', '#f59e0b', '#e11d48'],
                        borderWidth: 2, borderColor: '#ffffff', hoverOffset: 4
                    }]
                },
                options: {
                    maintainAspectRatio: false, responsive: true, cutout: '65%',
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } },
                    ...interactiveOptions,
                    onClick: (e, activeElements, chart) => {
                        if (activeElements.length > 0) {
                            const label = chart.data.labels[activeElements[0].index];
                            chartFilters.verdict = (chartFilters.verdict === label) ? null : label;
                            renderTable(); document.getElementById('explorer').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }
            });

            // 3. F500 (Pie)
            let f500Counts = { Yes: 0, No: 0 };
            jobData.forEach(j => { if (j.f500) f500Counts.Yes++; else f500Counts.No++; });

            chartInstances.f500 = new Chart(document.getElementById('fortuneChart'), {
                type: 'pie',
                data: {
                    labels: ['Fortune 500', 'Other Market'],
                    datasets: [{
                        data: [f500Counts.Yes, f500Counts.No],
                        backgroundColor: ['#1e293b', '#94a3b8'],
                        borderWidth: 2, borderColor: '#ffffff', hoverOffset: 4
                    }]
                },
                options: {
                    maintainAspectRatio: false, responsive: true,
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } },
                    ...interactiveOptions,
                    onClick: (e, activeElements, chart) => {
                        if (activeElements.length > 0) {
                            const label = chart.data.labels[activeElements[0].index];
                            chartFilters.f500 = (chartFilters.f500 === label) ? null : label;
                            renderTable(); document.getElementById('explorer').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }
            });

            // 4. Posted Recency (Pie)
            let ageCounts = { '‚â§ 3 Days': 0, '4-7 Days': 0, '> 7 Days': 0 };
            jobData.forEach(j => { ageCounts[getAgeBucket(j.posted)]++; });

            chartInstances.posted = new Chart(document.getElementById('postedChart'), {
                type: 'pie', // Changed from bar to pie
                data: {
                    labels: Object.keys(ageCounts),
                    datasets: [{
                        data: Object.values(ageCounts),
                        backgroundColor: ['#3b82f6', '#8b5cf6', '#cbd5e1'],
                        borderWidth: 2, borderColor: '#ffffff', hoverOffset: 4
                    }]
                },
                options: {
                    maintainAspectRatio: false, responsive: true,
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } },
                    ...interactiveOptions,
                    onClick: (e, activeElements, chart) => {
                        if (activeElements.length > 0) {
                            const label = chart.data.labels[activeElements[0].index];
                            chartFilters.posted = (chartFilters.posted === label) ? null : label;
                            renderTable(); document.getElementById('explorer').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }
            });
        }

        // =====================================================================
        // FALLBACK DATA (Used only if Git fetch fails)
        // =====================================================================
        function getFallbackData() {
            return [
                { title: "Principal Product Manager", company: "SAP", f500: true, score: 9.8, posted: "2 days ago", link: "#", verdict: "üü¢ YES ‚Äì BASE CV CAN BE USED AS-IS" },
                { title: "Senior Product Manager", company: "Chubb", f500: true, score: 9.7, posted: "1 week ago", link: "#", verdict: "üü¢ YES ‚Äì BASE CV CAN BE USED AS-IS" },
                { title: "Data Product Manager, Analytics", company: "FedEx", f500: true, score: 7.3, posted: "11 days ago", link: "#", verdict: "üü† MAYBE ‚Äì GENERAL FIT IMPROVEMENT" },
                { title: "Product Manager - Cybersecurity", company: "Pixalate", f500: false, score: 6.2, posted: "3 days ago", link: "#", verdict: "üü† MAYBE ‚Äì GENERAL FIT IMPROVEMENT" },
                { title: "Demand Management PM", company: "Applied Materials", f500: true, score: 4.5, posted: "2 days ago", link: "#", verdict: "üü• NO ‚Äì SEVERE SPECIALIZED DOMAIN GAP" }
            ];
        }

        // Trigger Load
        window.addEventListener('DOMContentLoaded', loadJobData);
    </script>
</body>
</html>
